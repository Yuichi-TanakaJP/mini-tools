# Decision Log: cherry-pick でブランチを分離した理由と順番（2026-01-09）

## 背景

優待期限（yutai-expiry）の UI 改善作業中に、PWA 対応・yutai-memo 追加など別テーマの変更が混在したブランチが発生した。
混在のまま PR するとレビュー不能・巻き戻し不能・差分肥大化になるため、cherry-pick でテーマ別に分離した。

## ゴール

- main は「動くものだけ」＋小さな PR で安全に進める
- WIP（table UI）は clean ブランチに隔離し、あとで落ち着いて育てる
- 取り逃し（混在ブランチにしか無い差分）は小 PR で救出してから混在ブランチを削除する

---

## 方針（意思決定）

### なぜ cherry-pick を使ったか

- 履歴を “テーマ単位” に再構成できる（PR の粒度が揃う）
- 既存の混在ブランチを無理に rebase/merge して事故るより安全
- 「最終的に main に入れたい変更」だけを確実に運べる

### なぜ “clean ブランチ” を作ったか

- table UI は影響範囲が大きく、PWA/memo と同じ PR に混ぜると破綻する
- まず main を安定させ、その上で UI を育てる方が判断が楽
- 後から rebase で main 追随できる（衝突は起きうるが、WIP 隔離が目的）

---

## cherry-pick の順番と根拠（実際の流れ）

### 1. PWA を先に main に入れる（優先度: 高）

**理由**

- ビルド・デプロイ経路に直結し、他作業の土台になる
- next-pwa / manifest / icons / next.config など “プロジェクト全体” の変更は先に確定させたい

**対象（例）**

- PWA 関連コミット（manifest/icons/service worker）
- build config / ignore files など

**結果**

- `npm run build` を通すところまで確認
- CSS Modules の `:root` 問題は `.shell { --ctl-h: ... }` に退避して解決

---

### 2. yutai-memo を独立ブランチに切り出す（優先度: 中）

**理由**

- ツール追加は機能として独立しており、レビュー単位としても独立が自然
- PWA と混ぜると差分が膨れるため、別 PR にしたい

**対象（例）**

- yutai-memo tool 本体
- home のリンク追加
- state 初期化（lazy initializer）など

**補足**

- 混在ブランチにだけ残っていた “アイコン” 差分（📝）は後で小 PR で救出した

---

### 3. table UI は clean ブランチで隔離（優先度: 低 / WIP）

**理由**

- UI/データ構造への影響が大きく、仕様が固まっていない
- main に入れるとレビュー不能＆巻き戻し不能になる

**対象（例）**

- `YutaiTable.tsx` / `YutaiRow.tsx` 追加
- ToolClient の table 表示用置き換え（WIP）
- 設計メモ（notes）

---

### 4. 取り逃し救出は “小 PR” で行う（必要に応じて）

**理由**

- 混在ブランチを消す前に「そこにしかない差分」を救出しておく
- 1PR=1 変更にして差分を明確化

**実例**

- home の yutai-memo アイコンを 🎁 → 📝 に修正（小 PR で救出）

---

## 混在ブランチの扱い

- 混在ブランチは最終的に削除（推奨）
- 理由：存在するだけで「どれが正？」が発生するため
- 代わりに、decision log と clean ブランチの notes で “意図” を保存する

---

## 今後の指針

- main: 小さく安全に（build/lint 通す）
- WIP: clean ブランチに隔離し、仕様が固まったら段階的に小 PR で入れる
- 取り逃し疑い: diff で確認し、小 PR で救出してから元ブランチを削除する
